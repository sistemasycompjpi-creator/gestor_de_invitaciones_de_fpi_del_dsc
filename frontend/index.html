<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Gestor de Invitaciones de la JPi</title>
    <link rel="stylesheet" href="./styles/style.css" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./assets/favicon.png"
    />
  </head>
  <body>
    <div class="app-container">
      <nav class="navbar">
        <div class="navbar-brand">
          <div class="navbar-logos">
            <img
              src="./assets/TECNMorelia.png"
              alt="ITM Logo"
              class="navbar-logo logo-itm"
            />
            <img
              src="./assets/Logo DSC.jpeg"
              alt="DSC Logo"
              class="navbar-logo logo-dsc"
            />
            <img
              src="./assets/jpi-sin-fondo.png"
              alt="JPi Logo"
              class="navbar-logo logo-jpi"
            />
          </div>
          <h1>Gestor de Invitaciones JPi</h1>
        </div>
        <div class="navbar-menu">
          <button class="nav-item active" data-page="lista">
            👥 Lista de Invitados
          </button>
          <button class="nav-item" data-page="agregar">
            ➕ Agregar Invitado
          </button>
          <button class="nav-item" data-page="invitaciones">
            📄 Generar Invitaciones
          </button>
          <button class="nav-item" data-page="estadisticas">
            📊 Estadísticas
          </button>
        </div>
      </nav>

      <main class="pages-container">
        <div class="page active" id="page-lista">
          <div class="page-header">
            <h2>👥 Lista de Invitados</h2>
          </div>
          <section class="filters-section">
            <h3>🔍 Filtrar por Rol</h3>
            <div class="filters">
              <button class="btn-filter active" data-filter="todos">
                📋 Todos
              </button>
              <button class="btn-filter" data-filter="asesor_t1">
                👨‍🏫 Asesor T1
              </button>
              <button class="btn-filter" data-filter="asesor_t2">
                👩‍ Asesor T2
              </button>
              <button class="btn-filter" data-filter="jurado_protocolo">
                📝 Jurado Protocolo
              </button>
              <button class="btn-filter" data-filter="jurado_informe">
                📄 Jurado Informe
              </button>
            </div>
            <div id="contador-filtro" class="contador">Total: 0 invitados</div>
          </section>
          <section class="lista-section">
            <div id="lista-invitados" class="invitados-grid">
              <div class="loading">Cargando...</div>
            </div>
          </section>
        </div>

        <div class="page" id="page-agregar">
          <div class="page-header">
            <h2>➕ Agregar Nuevo Invitado</h2>
          </div>
          <section class="form-section">
            <form id="form-invitado">
              <div class="form-group">
                <label for="nombre_completo">Nombre Completo *</label>
                <input
                  type="text"
                  id="nombre_completo"
                  name="nombre_completo"
                  required
                  placeholder="Ej: Dr. Juan Pérez García"
                />
              </div>
              <div class="form-group">
                <label for="caracter_invitacion"
                  >Carácter de la Invitación *</label
                >
                <input
                  type="text"
                  id="caracter_invitacion"
                  name="caracter_invitacion"
                  required
                  placeholder="Ej: Jurado en evento académico, Ponente magistral, etc."
                />
              </div>
              <div class="form-group">
                <label for="nota">Nota del Invitado (Opcional)</label>
                <textarea
                  id="nota"
                  name="nota"
                  rows="3"
                  placeholder="Agrega cualquier nota o comentario relevante sobre este invitado..."
                ></textarea>
              </div>
              <div class="cargos-section">
                <h3>💼 Puesto e Institución</h3>
                <p class="section-description">
                  Información del puesto/cargo y la institución del invitado
                </p>
                <div class="form-group">
                  <label for="puesto_completo">Puesto / Cargo *</label>
                  <input
                    type="text"
                    id="puesto_completo"
                    name="puesto_completo"
                    placeholder="Ej: Jefe del Departamento de Investigación"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="institucion"
                    >Institución / Organización / Empresa *</label
                  >
                  <input
                    type="text"
                    id="institucion"
                    name="institucion"
                    placeholder="Ej: Instituto Tecnológico de Morelia"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="abreviacion_org"
                    >Abreviación de la Institución</label
                  >
                  <input
                    type="text"
                    id="abreviacion_org"
                    name="abreviacion_org"
                    placeholder="Ej: ITM, UNAM, IPN"
                    maxlength="20"
                  />
                  <small style="color: #666; font-size: 0.85rem"
                    >Para nomenclatura de archivos (opcional, más corto)</small
                  >
                </div>
              </div>
              <div class="checkboxes-group">
                <h3>⭐ Estado del Invitado</h3>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="es_invitado_especial"
                    name="es_invitado_especial"
                  />
                  <label for="es_invitado_especial"
                    >🌟 <strong>Invitado Especial</strong> (VIP, autoridad,
                    personalidad destacada)</label
                  >
                </div>
              </div>
              <div class="checkboxes-group">
                <h3>👨‍🏫 Roles de Asesoría</h3>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="es_asesor_t1"
                    name="es_asesor_t1"
                  />
                  <label for="es_asesor_t1">Es Asesor T1</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="es_asesor_t2"
                    name="es_asesor_t2"
                  />
                  <label for="es_asesor_t2">Es Asesor T2</label>
                </div>
                <p class="info-text">
                  ℹ️ Los roles de jurado se calculan automáticamente según las
                  reglas establecidas
                </p>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  ✅ Guardar Invitado
                </button>
                <button type="reset" class="btn btn-secondary">
                  🔄 Limpiar Formulario
                </button>
              </div>
            </form>
          </section>
        </div>

        <div class="page" id="page-invitaciones">
          <div class="page-header">
            <h2>📄 Generar Invitaciones</h2>
          </div>
          <section class="invitaciones-section">
            <div class="invitaciones-container">
              <!-- Panel Izquierdo: Configuración -->
              <div class="invitaciones-panel-left">
                <div class="panel-section">
                  <h3>📁 Paso 1: Archivos Base</h3>
                  <p class="section-hint">
                    💡 Estos archivos se cargan una vez y se reutilizan para
                    todas las invitaciones. Verás ✅ cuando se carguen
                    correctamente.
                  </p>
                  <div class="file-upload-group">
                    <label for="file-plantilla-docx">
                      <span class="file-label"
                        >📄 Plantilla Base (DOCX con variables)</span
                      >
                      <input
                        type="file"
                        id="file-plantilla-docx"
                        accept=".docx"
                      />
                      <span class="file-status" id="status-plantilla-docx"
                        >Sin seleccionar</span
                      >
                    </label>
                  </div>

                  <div class="file-upload-group">
                    <label for="file-convocatoria">
                      <span class="file-label">📋 Convocatoria (PDF)</span>
                      <input type="file" id="file-convocatoria" accept=".pdf" />
                      <span class="file-status" id="status-convocatoria"
                        >Sin seleccionar</span
                      >
                    </label>
                  </div>

                  <div class="file-upload-group">
                    <label for="file-cronograma">
                      <span class="file-label"
                        >📅 Cronograma y Croquis (PDF)</span
                      >
                      <input type="file" id="file-cronograma" accept=".pdf" />
                      <span class="file-status" id="status-cronograma"
                        >Sin seleccionar</span
                      >
                    </label>
                  </div>

                  <button
                    class="btn btn-secondary btn-large"
                    id="btn-cargar-archivos"
                    style="margin-top: 15px; width: 100%"
                  >
                    ⬆️ Cargar Archivos al Servidor
                  </button>
                </div>

                <div class="panel-section">
                  <h3>📅 Paso 2: Configuración del Periodo</h3>
                  <p class="section-hint">
                    💡 Define el año y periodo académico. Ejemplo:
                    <code>2025.1</code> para Enero-Junio 2025
                  </p>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="periodo-anio">Año *</label>
                      <input
                        type="number"
                        id="periodo-anio"
                        placeholder="2025"
                        min="2020"
                        max="2050"
                        required
                      />
                    </div>

                    <div class="form-group">
                      <label for="periodo-numero">Periodo *</label>
                      <select id="periodo-numero" required>
                        <option value="">Seleccionar...</option>
                        <option value="1">1 (Enero - Junio)</option>
                        <option value="3">3 (Agosto - Diciembre)</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="panel-section">
                  <h3>ℹ️ Paso 3: Información del Evento</h3>
                  <p class="section-hint">
                    💡 La edición está prepuesta en la plantilla. Solo ingresa
                    el mes y año del evento (ej: "noviembre 2025"). La plantilla
                    usa: "La FPiT se llevará a cabo el viernes
                    <code>{{ fecha_evento }}</code> en horario de 09:00 – 14:20
                    hrs."
                  </p>

                  <div class="form-group">
                    <label for="edicion-evento">Mes y Año del Evento *</label>
                    <input
                      type="text"
                      id="edicion-evento"
                      placeholder="Ej: noviembre 2025"
                      required
                    />
                    <small class="field-hint"
                      >Ingresa el mes y año del evento (Ej: "noviembre 2025",
                      "junio 2026"). La edición ya está prepuesta en la
                      plantilla.</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="fecha-evento">Fecha del Evento *</label>
                    <input
                      type="text"
                      id="fecha-evento"
                      placeholder="Ej: 13 de junio de 2025"
                      required
                    />
                    <small class="field-hint"
                      >Fecha completa en formato largo (se usa en: "el viernes
                      {{ fecha_evento }} en horario de...")</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="fecha-carta">Fecha de la Carta *</label>
                    <input type="date" id="fecha-carta" required />
                    <small class="field-hint"
                      >Se convertirá automáticamente a: "28 de octubre de
                      2025"</small
                    >
                  </div>
                </div>

                <div class="panel-section">
                  <h3>🎯 Paso 4: Generar Invitaciones</h3>

                  <div class="output-info">
                    <p><strong>📂 Carpeta de destino:</strong></p>
                    <p class="output-path" id="output-path">
                      ~/Desktop/<span id="folder-name-display"
                        >Configurar año y periodo primero</span
                      >/
                    </p>
                    <div class="info-grid">
                      <div class="info-item">
                        <span class="info-icon">📋</span>
                        <span
                          >Se generarán para
                          <strong>todos los invitados</strong> registrados</span
                        >
                      </div>
                      <div class="info-item">
                        <span class="info-icon">📝</span>
                        <span
                          >Nomenclatura:
                          <code>2025.1-FPiT-DOSSIER-ITM-Nombre.pdf</code></span
                        >
                      </div>
                      <div class="info-item">
                        <span class="info-icon">📄</span>
                        <span>Dossier: Carta + Convocatoria + Cronograma</span>
                      </div>
                    </div>
                  </div>

                  <button class="btn btn-primary btn-large" id="btn-generar">
                    🚀 Generar Todas las Invitaciones
                  </button>
                </div>
              </div>

              <!-- Panel Derecho: Guía de Uso -->
              <div class="invitaciones-panel-right">
                <div class="preview-container">
                  <h3>� Guía de Uso</h3>

                  <div
                    style="
                      padding: 20px;
                      background: #f8f9fa;
                      border-radius: 8px;
                      line-height: 1.8;
                    "
                  >
                    <h4 style="margin-top: 0; color: var(--primary-blue)">
                      ✅ Pasos para Generar Invitaciones:
                    </h4>

                    <ol style="padding-left: 20px">
                      <li style="margin-bottom: 15px">
                        <strong>📁 Selecciona los 3 archivos:</strong>
                        <ul style="margin-top: 5px; color: #666">
                          <li>
                            Plantilla DOCX (con variables como
                            <code>{{ nombre_completo }}</code>)
                          </li>
                          <li>PDF de Convocatoria</li>
                          <li>PDF de Cronograma y Croquis</li>
                        </ul>
                      </li>

                      <li style="margin-bottom: 15px">
                        <strong>⬆️ Carga los archivos:</strong>
                        <ul style="margin-top: 5px; color: #666">
                          <li>Click en "⬆️ Cargar Archivos al Backend"</li>
                          <li>Espera la confirmación</li>
                        </ul>
                      </li>

                      <li style="margin-bottom: 15px">
                        <strong>📅 Configura el Periodo:</strong>
                        <ul style="margin-top: 5px; color: #666">
                          <li>Año (ej: 2025)</li>
                          <li>Periodo (1 o 3)</li>
                        </ul>
                      </li>

                      <li style="margin-bottom: 15px">
                        <strong>ℹ️ Llena los datos del Evento:</strong>
                        <ul style="margin-top: 5px; color: #666">
                          <li>
                            Mes y Año (ej: "noviembre 2025") - La edición está
                            prepuesta en la plantilla
                          </li>
                          <li>Fecha del evento (ej: "13 de junio de 2025")</li>
                          <li>
                            Fecha de la carta (se auto-formatea a español)
                          </li>
                        </ul>
                      </li>

                      <li style="margin-bottom: 15px">
                        <strong>🚀 Genera las Invitaciones:</strong>
                        <ul style="margin-top: 5px; color: #666">
                          <li>Click en "🚀 Generar Todas las Invitaciones"</li>
                          <li>
                            ⚠️ La pantalla se bloqueará durante el proceso
                          </li>
                          <li>Se generarán PDFs para TODOS los invitados</li>
                          <li>
                            Ubicación:
                            <code
                              >~/Desktop/{{año}}.{{periodo}}-invitaciones/</code
                            >
                          </li>
                        </ul>
                      </li>
                    </ol>

                    <hr
                      style="
                        margin: 20px 0;
                        border: none;
                        border-top: 1px solid #ddd;
                      "
                    />

                    <h4 style="color: var(--primary-blue)">
                      📝 Nomenclatura de Archivos:
                    </h4>
                    <p
                      style="
                        margin: 10px 0;
                        font-family: monospace;
                        background: white;
                        padding: 10px;
                        border-radius: 4px;
                        font-size: 0.9rem;
                      "
                    >
                      {{año}}.{{periodo}}-FPiT-DOSSIER-{{Abreviación}}-{{Nombre}}.pdf
                    </p>
                    <p style="color: #666; font-size: 0.9rem; margin: 10px 0">
                      Ejemplo:
                      <code>2025.1-FPiT-DOSSIER-ITM-Dr. Juan Pérez.pdf</code>
                    </p>

                    <hr
                      style="
                        margin: 20px 0;
                        border: none;
                        border-top: 1px solid #ddd;
                      "
                    />

                    <h4 style="color: var(--primary-blue)">
                      📄 Estructura del Dossier:
                    </h4>
                    <ul style="padding-left: 20px; color: #666">
                      <li>Página 1: Carta personalizada</li>
                      <li>Página 2: Convocatoria</li>
                      <li>Página 3+: Cronograma y Croquis</li>
                    </ul>

                    <hr
                      style="
                        margin: 20px 0;
                        border: none;
                        border-top: 1px solid #ddd;
                      "
                    />

                    <div
                      style="
                        background: #fff3cd;
                        padding: 15px;
                        border-radius: 4px;
                        border-left: 4px solid #ffc107;
                      "
                    >
                      <strong>💡 Consejo:</strong>
                      <p style="margin: 5px 0 0 0; color: #856404">
                        Asegúrate de agregar todos los invitados ANTES de
                        generar. El sistema generará una invitación para cada
                        invitado registrado en la base de datos.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="page" id="page-estadisticas">
          <div class="page-header">
            <h2>📊 Estadísticas</h2>
          </div>
          <section class="estadisticas-section">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">👥</div>
                <div class="stat-content">
                  <h3 id="stat-total">0</h3>
                  <p>Total de Invitados</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">👨‍🏫</div>
                <div class="stat-content">
                  <h3 id="stat-t1">0</h3>
                  <p>Asesores T1</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">👩‍🏫</div>
                <div class="stat-content">
                  <h3 id="stat-t2">0</h3>
                  <p>Asesores T2</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">📝</div>
                <div class="stat-content">
                  <h3 id="stat-protocolo">0</h3>
                  <p>Jurados Protocolo</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">📄</div>
                <div class="stat-content">
                  <h3 id="stat-informe">0</h3>
                  <p>Jurados Informe</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">🎯</div>
                <div class="stat-content">
                  <h3 id="stat-ambos">0</h3>
                  <p>Ambos Jurados</p>
                </div>
              </div>
            </div>
            <div class="chart-placeholder">
              <div class="coming-soon-mini">
                <p>📈 Gráficos y visualizaciones avanzadas próximamente</p>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal-overlay" id="modal-overlay">
      <div class="modal">
        <div class="modal-icon" id="modal-icon">✅</div>
        <h3 class="modal-title" id="modal-title">Título</h3>
        <p class="modal-message" id="modal-message">Mensaje</p>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-primary" id="modal-btn-ok">
            Aceptar
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts modulares - orden de carga importante -->
    <script src="./js/api.js"></script>
    <script src="./js/ui.js"></script>
    <script src="./js/navigation.js"></script>
    <script src="./js/estadisticas.js"></script>
    <script src="./js/invitados-lista.js"></script>
    <script src="./js/invitados-form.js"></script>
    <script src="./js/invitaciones.js"></script>
    <script src="./js/main.js"></script>
  </body>
</html>
